# Cursor Configuration for dendrita by ennui

## Priority: Review .dendrita first

**IMPORTANT:** Before any action, ALWAYS review the `.dendrita/` folder to understand the system context and established work patterns.

---

## .dendrita Structure

`.dendrita/` is a reflective base that contains:

1. **`.dendrita/users/[user-id]/skills/`** - Contextual knowledge skills for different types of work (user-specific domain knowledge)
   - `skill-rules.json` - Defines when to suggest each skill based on prompts and files
   - Each skill has its documentation in `[skill-name]/SKILL.md`
   - **Paradigm:** Skills contain user-specific domain knowledge (sustainability, social impact, project management) and are stored per user

2. **`.dendrita/users/[user-id]/agents/`** - Specialized agents for complex tasks (user-specific domain knowledge)
   - Documentation of agents that can be activated based on context
   - **Naming conventions:** See `.dendrita/config-estilo.json` and `.dendrita/users/[user-id]/agents/README.md` for agent naming rules
   - **Paradigm:** Agents contain user-specific domain knowledge and are stored per user

3. **`.dendrita/users/[user-id]/work-modes/`** - General work modes and user preferences (user-specific)
   - `user-work-mode.md` - General user work preferences and behavior guidelines
   - Acts as a "system prompt" base that applies to all sessions
   - Can be adjusted dynamically when user requests changes
   - **Paradigm:** Work-modes are user-specific preferences and serve as templates for other users

4. **`.dendrita/hooks/`** - Behavior logic references
   - **NOTE:** These files are references/documentation, NOT executable
   - Document the expected behavior that Cursor must read and apply

5. **`.dendrita/settings.json`** - Project metadata (not execution configuration)

6. **`.dendrita/config-estilo.json`** - Style and naming conventions for dendrita system components
   - Naming rules for agents, skills, and hooks
   - Style guidelines for dendrita infrastructure

---

## How to use .dendrita

### 1. When receiving a user prompt:

1. **Apply `.dendrita/users/[user-id]/work-modes/user-work-mode.md`** - Always follow user's general work preferences
   - Ask for context (workspace, project name, product relationship) before starting work
   - Plan top-down and create documents iteratively
   - Never create multiple documents at once without confirmation

2. **Review `.dendrita/users/[user-id]/skills/skill-rules.json`** to identify relevant skills
3. **Read the keywords and intentPatterns** from the prompt
4. **If there are matches:**
   - Read the corresponding `SKILL.md` file in `.dendrita/users/[user-id]/skills/[skill-name]/SKILL.md`
   - Apply the contextual knowledge from that skill
   - Suggest using the skill to the user if appropriate

### 2. When editing files:

1. **Identify the project context** based on the file path:
   - `workspaces/[workspace]/ğŸš€ active-projects/[proyecto]/` â†’ Active project
   - `workspaces/[workspace]/âš™ï¸ company-management/ğŸ“š best-practices/[tipo-proyecto]/` â†’ Template/best practices (workspace-specific, fallback to ennui if missing)
   - `workspaces/[workspace]/work-modes/[modo].md` â†’ **DEPRECATED:** Work-modes de workspace han sido consolidados en agents y skills. Ver agents y skills en `.dendrita/users/[user-id]/` para metodologÃ­as especializadas.
   
   **Note:** Each workspace has its own best-practices (inside company-management), products, work-modes, stakeholders, and tools-templates. If a workspace doesn't have specific content, fallback to `workspaces/ennui/` as the reference standard.

2. **Check for style configuration files** in the identified context:
   - **For dendrita components** (agents, skills, hooks): Check `.dendrita/config-estilo.json`
   - **For workspace files**: Check `workspaces/[empresa]/config-estilo.json`
   - **For project files**: Check `workspaces/[empresa]/ğŸš€ active-projects/[proyecto]/config-estilo.json` (project-level overrides)
   - **Apply style rules** from these configuration files (project-level rules override company-level rules, dendrita rules apply to `.dendrita/` components)

3. **Apply the best practices** from the identified context

4. **Maintain consistency** with the project's persistent documents:
   - `master-plan.md`
   - `project-context.json` (combines current-context.md, master-plan.md, and tasks.md)
   - `tasks.md`

### 3. When working with projects:

1. **Always read `project-context.json`** from the project before responding (or `master-plan.md` and `tasks.md` if JSON doesn't exist yet)
2. **Review `tasks.md`** to understand the task status (or use `project-context.json` which includes parsed tasks)
3. **Consult `master-plan.md`** to understand the general strategy (or use `project-context.json` which includes parsed master-plan)
4. **Update `project-context.json`** by running `tsx .dendrita/integrations/scripts/update-project-context.ts` after important decisions

**NOTE:** `current-context.md` files have been migrated to `project-context.json`. Only JSON files are used for context.

---

## Available skills in .dendrita/users/[user-id]/

Review `.dendrita/users/[user-id]/skills/skill-rules.json` to see all available skills and when to activate them:

**IMPORTANT:** Skills and agents are user-specific domain knowledge. They are stored in `.dendrita/users/[user-id]/` to reflect that they contain private, domain-specific knowledge rather than generic infrastructure.

- **gestion-proyectos**: ennui-dendrita project management
- **diagnostico-sostenibilidad**: ESG and sustainability diagnostics
- **sistema-mel**: Monitoring, Evaluation and Learning systems
- **pipeline-proyectos**: Project and alliance pipeline
- **bootcamp-fundraising**: Fundraising bootcamps and capacity building
- **gestion-stakeholders**: Stakeholder management, strategic alliances, and multi-actor coordination

---

## Hooks as references

Files in `.dendrita/hooks/` are **behavior references**, NOT executable scripts.

**Expected behavior based on hooks:**

1. **session-initialization-verification** (ALWAYS run at start of new conversation):
   - **CRITICAL:** At the start of EVERY new conversation, read `.dendrita/hooks/session-initialization-verification.md`
   - Verify if user exists and is configured
   - Verify if `dendrita_alias` is configured in user profile
   - Verify if enabled integrations have credentials configured
   - **Verify and execute active scrapers according to their rules** (daily initialization)
   - Check scrapers in Supabase (Gmail, Calendar) and determine if they need execution based on `last_sync_at`
   - If configuration is incomplete, perform soft-initialization of missing items
   - Show brief summary of configuration status including scrapers status
   - This hook MUST run before processing the first user message

2. **user-work-mode** (ALWAYS apply at start of new conversation):
   - **CRITICAL:** At the start of EVERY new conversation, read `.dendrita/users/[user-id]/work-modes/user-work-mode.md`
   - Apply user's general work preferences automatically
   - Follow the guidelines for asking context, planning top-down, and creating documents iteratively
   - Update this work-mode when user says "actÃºa mÃ¡s de esta determinada forma" or similar
   - This work-mode MUST be applied before processing any user prompts

3. **repo-initialization**:
   - If no users exist in `.dendrita/users/`, start full initialization process
   - Ask user for basic data (identifier, workspace, roles, preferences, alias)
   - Create user structure and profile

4. **skill-activation-prompt**: 
   - Reads `.dendrita/users/[user-id]/skills/skill-rules.json`
   - Identifies relevant skills based on user prompt
   - Suggests activating corresponding skills from user's skills directory

5. **dendrita-alias-activation**:
   - When user mentions dendrita alias in prompt, activate workspace context
   - Respond using information from user's workspaces

6. **post-tool-use-tracker**:
   - Maintains mental record of which files have been edited
   - Identifies the context of edited files
   - Considers this context for future actions

7. **dendrita-infrastructure-modification**:
   - Detects when `.dendrita/` infrastructure is being modified
   - Assesses impact on affected components
   - Reviews documentation before making changes
   - Maintains consistency and updates related files
   - Warns about breaking changes and provides migration guidance

8. **dendrita-comunicacion** (ALWAYS run when infrastructure changes):
   - **CRITICAL:** Automatically log all changes to dendrita infrastructure as "tweets" in timeline
   - Detects changes in `.dendrita/hooks/` (hooks created, modified, deleted)
   - Detects changes in `.dendrita/users/[user-id]/skills/` (skills created, modified, deleted)
   - Detects changes in `.dendrita/users/[user-id]/agents/` (agents created, modified, deleted)
   - Detects changes in `.dendrita/integrations/scripts/` (scripts created, modified, deleted)
   - Generates tweet entry with timestamp, type badge, action, component name, and description
   - Appends tweet to `.dendrita/comunicacion/timeline.md` (most recent first)
   - Creates a communication channel for dendrita to document its own evolution
   - This hook MUST run automatically when infrastructure changes are detected

9. **work-timeline** (ALWAYS run when work changes):
   - **CRITICAL:** Automatically log all changes to work projects as "tweets" in workspace timelines
   - Detects changes in `workspaces/[workspace]/ğŸš€ active-projects/**/*` (projects created, modified, archived)
   - Detects changes in project files (`master-plan.md`, `project-context.json`, `tasks.md`)
   - Detects task completions, milestones, decisions, and status changes
   - Generates tweet entry with timestamp, type badge, action, project/component name, and description
   - Appends tweet to `workspaces/[workspace]/ğŸ“Š work-timeline.md` (most recent first)
   - Creates a communication channel to document work evolution in each workspace
   - This hook MUST run automatically when work changes are detected

10. **markdown-source-of-truth-verification** (ALWAYS run when reading workspace markdown):
   - **CRITICAL:** When reading a markdown document from `workspaces/[workspace]/`, execute verification script
   - Verify that the markdown document is the "source of truth" by comparing it with JSON/CSV data from work systems
   - Execute `.dendrita/integrations/scripts/verify-markdown-source-of-truth.ts` automatically
   - Compare key data points between markdown and source data (JSON/CSV)
   - Detect discrepancies (different values, missing data, additional data)
   - Generate verification report
   - Show results non-intrusively (don't block document reading)
   - If discrepancies are found, suggest updating the document or regenerating from source
   - This hook MUST run when reading workspace markdown documents that represent company memory

**NOTE:** Do not attempt to execute these scripts. They are references to understand expected behavior.

---

## ennui-dendrita project structure

```
ennui-dendrita/
â”œâ”€â”€ workspaces/[workspace-name]/
â”‚   â”œâ”€â”€ ğŸš€ active-projects/           â† Proyectos activos
â”‚   â”œâ”€â”€ .archived-projects/           â† Proyectos archivados (oculto)
â”‚   â”œâ”€â”€ âš™ï¸ company-management/        â† GestiÃ³n general (opcional)
â”‚   â”‚   â””â”€â”€ ğŸ“š best-practices/        â† Templates y metodologÃ­as (REQUIRED)
â”‚   â”œâ”€â”€ ğŸ“¦ products/                  â† Portafolio de productos (REQUIRED)
â”‚   â”œâ”€â”€ ğŸ¤ stakeholders/              â† GestiÃ³n de aliados (REQUIRED)
â”‚   â”œâ”€â”€ ğŸ› ï¸ tools-templates/            â† Herramientas reutilizables (REQUIRED)
â”‚   â”œâ”€â”€ config-estilo.json            â† Reglas de estilo y marca (opcional)
â”‚   â””â”€â”€ README.md                     â† DocumentaciÃ³n del workspace
â”‚
â”‚   Cada proyecto en ğŸš€ active-projects/ debe tener:
â”‚   â”œâ”€â”€ master-plan.md
â”‚   â”œâ”€â”€ project-context.json (combina current-context.md, master-plan.md y tasks.md)
â”‚   â””â”€â”€ tasks.md
â”‚
â””â”€â”€ .dendrita/          â† ALWAYS review first
    â”œâ”€â”€ users/[user-id]/
    â”‚   â”œâ”€â”€ agents/     â† Conocimiento de dominio especÃ­fico del usuario
    â”‚   â”œâ”€â”€ skills/     â† Conocimiento de dominio especÃ­fico del usuario
    â”‚   â”œâ”€â”€ work-modes/ â† Preferencias generales de trabajo del usuario
    â”‚   â”œâ”€â”€ profile.json
    â”‚   â””â”€â”€ profiles/
    â”œâ”€â”€ hooks/          â† References, do not execute
    â”œâ”€â”€ integrations/   â† Herramientas tÃ©cnicas genÃ©ricas (no conocimiento de dominio)
    â”œâ”€â”€ templates/      â† Templates para workspaces y usuarios
    â”œâ”€â”€ WORKSPACE-STRUCTURE.md  â† Estructura estÃ¡ndar de workspaces
    â””â”€â”€ settings.json   â† Metadata
```

**IMPORTANT:** Todos los workspaces deben seguir la misma estructura estÃ¡ndar. Ver `.dendrita/WORKSPACE-STRUCTURE.md` para detalles completos.

---

## Recommended workflow

### At the start of a new conversation (BEFORE processing first user message):

1. **Read `.dendrita/hooks/session-initialization-verification.md`** â†’ Execute verification logic
2. **Read `.dendrita/users/[user-id]/work-modes/user-work-mode.md`** â†’ Apply user's general work preferences
3. **Verify user configuration** â†’ Check if user exists, alias configured, integrations connected
4. **Perform soft-initialization** â†’ Configure only missing items if needed
5. **Show configuration status** â†’ Brief summary to user

### When receiving user prompts:

1. **Apply `.dendrita/users/[user-id]/work-modes/user-work-mode.md`** â†’ Follow user's general work preferences
   - Ask for context (workspace, project name, product relationship) if not clear
   - Plan top-down and create documents iteratively
   - Never create multiple documents at once without confirmation

2. **User sends prompt** â†’ Review `.dendrita/users/[user-id]/skills/skill-rules.json`
3. **Identify relevant skills** â†’ Read corresponding `SKILL.md` from `.dendrita/users/[user-id]/skills/[skill-name]/SKILL.md`
4. **Check for dendrita alias mentions** â†’ If detected, activate workspace context
5. **Identify project** â†’ Read `project-context.json` (or `master-plan.md` and `tasks.md` if JSON doesn't exist)
6. **Respond with context** â†’ Apply knowledge from skills and project
7. **Update documents** â†’ Update `project-context.json` by running `tsx .dendrita/integrations/scripts/update-project-context.ts` if needed

---

## Style Configuration

### Dendrita System Style
`.dendrita/config-estilo.json` contains naming conventions for dendrita system components:
- **Agents**: Format `[rol]-[Ã¡rea].md` (e.g., `analista-mel.md`, `estratega-sostenibilidad.md`)
- **Skills**: Format `[nombre-skill]/SKILL.md` (e.g., `gestion-proyectos/`)
- **Hooks**: Format `[nombre-hook].md` (e.g., `skill-activation-prompt.md`)
- **Rules**: All lowercase, hyphens as separators, no spaces or special characters
- **YAML frontmatter**: `name` field must match filename exactly (without `.md`)

**See `.dendrita/agents/README.md` for detailed agent naming conventions and validation checklist.**

### Chat Naming Conventions

**IMPORTANT:** While Cursor doesn't support automatic chat title generation, these conventions should be followed when manually naming chats for better organization.

#### Project Chats
**Format:** `[workspace] - [proyecto] - [tarea]`

**Examples:**
- `ennui - dendrita-comunicacion - revisar reglas de nombramiento`
- `iami - energy-balls - actualizar README`
- `ennui - ennui-x-NOSxOTROS - seguimiento tareas`

**Rules:**
- Workspace in lowercase
- Project name as it appears in `ğŸš€ active-projects/`
- Task description concise but descriptive

#### Work Type Chats
**Format:** `[workspace] - [tipo] - [descripcion]`

**Types:** `producto`, `mel`, `sostenibilidad`, `fundraising`, `aliados`, `proyectos`

**Examples:**
- `iami - producto - energy-balls README`
- `ennui - mel - anÃ¡lisis trimestral`
- `ennui - sostenibilidad - diagnÃ³stico ESG`

#### Skill/Agent Chats
**Format:** `[workspace] - [skill/agent] - [contexto]`

**Examples:**
- `ennui - estratega-sostenibilidad - diagnÃ³stico ESG`
- `ennui - gestor-proyectos - seguimiento tareas`
- `ennui - analista-mel - reporte trimestral`

#### Infrastructure Modification Chats
**Format:** `dendrita - [tipo-componente] - [accion] - [nombre-especifico]`

**Components and Actions:**

1. **Skills:**
   - `dendrita - skill - add - [nombre-skill]`
   - `dendrita - skill - modify - [nombre-skill]`
   - Example: `dendrita - skill - add - gestion-proyectos`

2. **Agents:**
   - `dendrita - agent - add - [nombre-agent]`
   - `dendrita - agent - modify - [nombre-agent]`
   - Example: `dendrita - agent - modify - analista-mel`

3. **Hooks:**
   - `dendrita - hook - add - [nombre-hook]`
   - `dendrita - hook - modify - [nombre-hook]`
   - Example: `dendrita - hook - add - skill-activation-prompt`

4. **Integrations:**
   - `dendrita - integration - add - [nombre-integration]`
   - `dendrita - integration - modify - [nombre-integration]`
   - Example: `dendrita - integration - modify - supabase-sync`

5. **Structure:**
   - `dendrita - structure - modify - [Ã¡rea]`
   - Example: `dendrita - structure - modify - workspace-standards`

6. **Config:**
   - `dendrita - config - modify - [archivo]`
   - Example: `dendrita - config - modify - config-estilo.json`

7. **Refactoring:**
   - `dendrita - refactor - [descripcion]`
   - Example: `dendrita - refactor - agents-naming-conventions`

8. **Breaking Changes:**
   - `dendrita - breaking - [componente] - [descripcion]`
   - Example: `dendrita - breaking - structure - workspace-standards`

**Short variations** (for simple actions):
- `dendrita - skill - add`
- `dendrita - hook - modify`

**General Rules:**
- Use lowercase always
- Separate sections with ` - ` (space-hyphen-space)
- Use hyphens `-` within section names
- Be descriptive but concise
- Include enough context to identify the chat quickly
- Use actual file/folder names when possible

**See `.dendrita/config-estilo.json` for complete chat naming conventions.**

### Emoji Files and Backup System

#### Emojis in File/Folder Names
- **Allowed**: Files in `âš™ï¸ company-management/` and files within project folders (except system files)
- **Allowed**: Project folder names in `ğŸš€ active-projects/` and `.archived-projects/`
- **Not allowed**: System files (`master-plan.md`, `project-context.json`, `tasks.md`, etc.)
- **Not allowed**: System folder names (`ğŸ“š best-practices/`, `ğŸ“¦ products/`, `ğŸ¤ stakeholders/`, `ğŸ› ï¸ tools-templates/`, etc.)

#### Backup System
- Files/folders with emojis automatically get hidden backup versions
- Backup files are prefixed with `.` (dot) and use sanitized names
- Backups are updated on-demand when user requests
- Use script: `ts-node .dendrita/integrations/scripts/update-emoji-backups.ts`

#### When creating files with emojis:
1. Create the file with emoji name (e.g., `âœ… Participantes aceptados.md`)
2. Automatically create hidden backup (e.g., `.participantes-aceptados.md`)
3. Inform user about backup creation

#### When user requests backup update:
1. Run backup script for specified file/workspace
2. Update hidden backup with current content
3. Confirm update completion

**See `.dendrita/hooks/emoji-files-backup.md` for complete backup system documentation.**

### Company and Project Style Configuration

Each company can have a `config-estilo.json` file in `workspaces/[empresa]/` containing:
- **Style rules**: Writing conventions, nomenclature, formatting guidelines
- **Company-specific conventions**: Brand guidelines, naming standards
- **Scope**: Applies to all files within that company's directory

Projects can optionally override with their own `config-estilo.json` in `workspaces/[empresa]/ğŸš€ active-projects/[proyecto]/`.

**Note**: `config-estilo.json` now unifies both style rules (`reglas_estilo`) and brand configuration (`brand`) in a single file. Previously separated into `brand-config.json` and `config-estilo.json`.

**Example**: `workspaces/ennui/config-estilo.json` specifies that "ennui" must always be written in lowercase as a style decision, and includes brand colors and typography configuration.

---

## Important reminders

- âœ… `.dendrita/` is reflective metadata, does NOT require installation
- âœ… Hooks are behavior references, NOT executed
- âœ… Always review `.dendrita/` before important actions
- âœ… **Always check `config-estilo.json`** when working with company/project files
- âœ… **For dendrita components (agents, skills, hooks): Check `.dendrita/config-estilo.json`** for naming conventions
- âœ… **When creating agents:** Follow naming pattern `[rol]-[Ã¡rea].md` and ensure YAML `name` matches filename
- âœ… **Paradigm:** Agents and skills are user-specific domain knowledge stored in `.dendrita/users/[user-id]/`, not generic infrastructure
- âœ… **When naming chats manually:** Follow chat naming conventions from `.dendrita/config-estilo.json` for better organization
- âœ… Maintain consistency with ennui-dendrita project structure
- âœ… Update `project-context.json` by running `tsx .dendrita/integrations/scripts/update-project-context.ts` after important decisions
- âœ… **NOTE:** `current-context.md` files have been migrated to `project-context.json`. Only JSON files are used for context.

---

**For more information about the project, review the README.md at the root.**
